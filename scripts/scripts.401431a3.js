"use strict";angular.module("blockflojtApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/spotify-callback",{templateUrl:"views/spotify-callback.html",controller:"SpotifyCallback"}).otherwise({redirectTo:"/"})}]),angular.module("blockflojtApp").controller("MainCtrl",["$scope","$rootScope","$http","$q","$timeout","$window",function(a,b,c,d,e){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.resultSong,a.pictures=[],a.currentPhoto,a.currentPhotoIndex=0,a.hashtagArray,angular.element("body").css({"background-color":"#333"}),angular.element(".footer").css({position:"relative"});var f={mood:[],style:[]},g=function(){b.currentHashtag||(b.currentHashtag="happy"),h().then(function(){console.log("new photo: ",a.pictures[a.pictures.length-1]);var b,c;a.hashtagArray=[],a.currentPhoto=a.pictures[a.pictures.length-1],console.log("photo:",a.currentPhoto),a.hashtagArray=angular.copy(a.currentPhoto.tags),c=a.hashtagArray.indexOf(a.currentHashtag),a.hashtagArray.splice(c,1),a.hashtagArray.length>0&&(b=a.hashtagArray.length>3?a.hashtagArray.slice(0,3):angular.copy(a.hashtagArray),i(b))})},h=function(){var b="f12ed20fcae6402d8ccbd89ed033a905",d="https://api.instagram.com/v1/tags/",e="/media/recent?client_id=",f="&callback=JSON_CALLBACK",g=d+a.currentHashtag+e+b+f;return c.jsonp(g).success(function(b){var c=b.data[0],d=c.images.standard_resolution.url,e=c.user,f=c.tags;a.pictures.push({picURL:d,user:e,tags:f})}).error(function(a){console.log("Error when fetching images from Instagram",a)})},i=function(b){var h="http://developer.echonest.com/api/v4/song/search",i={api_key:"CEWROMDFMFUUW1QCN",results:1,sort:"song_hotttnesss-desc",bucket:["song_hotttnesss","tracks","id:spotify","audio_summary"],callback:"JSON_CALLBACK",format:"jsonp"},j=["mood","style","artist","title"],k=[];for(var l in b)for(var m in j)if(!f[j[m]]||f[j[m]].indexOf(b[l])>-1){var n=angular.copy(i);n[j[m]]=b[l],k.push(c.jsonp(h,{params:n}))}d.all(k).then(function(b){var d=0;for(var f in b){var h=b[f].data.response.songs[0];if(console.log("song: ",h),h&&h.song_hotttnesss>d)if(d=h.song_hotttnesss,0===h.tracks.length)a.resultSong=void 0;else{a.resultSong={title:h.title,artist_name:h.artist_name,duration:h.audio_summary.duration,spotifyURI:h.tracks[0].foreign_id,image:""};var i=a.resultSong.spotifyURI.match(/track\:(.*)/)[1],j="https://api.spotify.com/v1/tracks/"+i;c.get(j).success(function(b){a.resultSong.image=b.album.images[0].url,console.log(a.resultSong)}).error(function(a){console.log(a)})}}if(console.log("resultSong: ",a.resultSong),void 0===a.resultSong)a.currentPhotoIndex++,g();else{var k=document.createElement("a");k.href=a.resultSong.spotifyURI,k.click(),e(g,1e3*a.resultSong.duration)}})};a.addSong=function(a){a=a?a:"spotify:track:2QhURnm7mQDxBb5jWkbDug";var d=localStorage.getItem("me"),e=b.playlist,f=e.match(/playlist\:(.*)/)[1],g="https://api.spotify.com/v1/users/"+d+"/playlists/"+f+"/tracks?uris="+a;c.post(g,{}).success(function(a){console.log("Success!"),console.log(a)}).error(function(a){console.log(a)})},g()}]),angular.module("blockflojtApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("blockflojtApp").controller("AdminCtrl",["$scope","$rootScope","$location","$http",function(a,b,c,d){function e(){var a="https://api.spotify.com/v1/me";d.get(a).success(function(a){localStorage.setItem("me",a.id)}).error(function(a){console.log(a)})}a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],angular.element("body").css({"background-color":"#333"}),angular.element(".footer").css({position:"absolute",bottom:"0"}),a.startPartyMode=function(){b.currentHashtag=angular.copy(a.hashtag),a.createPlaylist(a.hashtag),c.path("/")};var f="https://accounts.spotify.com/authorize?client_id=",g="433586e0441c40bbbfba5bc3ee5d55b8",h="&response_type=token&redirect_uri=",i="http://localhost:9000/spotify-callback.html",j="&scope=playlist-modify-public playlist-modify-private";if(a.loginURL=f+g+h+i+j,localStorage.getItem("hash")){var k=/access_token=(.*)&token/,l=localStorage.getItem("hash"),m=l.match(k)[1];localStorage.setItem("at",m)}d.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("at"),e(),a.createPlaylist=function(a){function c(){var b=new Date;return"#"+a+" "+b.toDateString()+" By Blockflöjt"}console.log;var e="https://api.spotify.com/v1/users/",f=e+localStorage.getItem("me")+"/playlists";d.post(f,{name:c(),"public":!0}).success(function(a){b.playlist=a.uri}).error(function(a){console.log(a)})}}]),angular.module("blockflojtApp").controller("SpotifyCallback",["$scope","$routeParams",function(a,b){a.data=b.access_token,a.data+="    "+b.expires_in}]),angular.module("blockflojtApp").directive("aboutDirective",function(){return{template:'<div class="footer"><div id="about-section" class="container-fluid"><h2 class="text-center">About</h2><p class="text-center">Quepic is the result of 24 hours of hacking at Diversity, a hackathon held at Spotify HQ</p><div class="col-xs-3 img-wrapper"><img class="col-xs-12" src="images/jakob.png"><p class="col-xs-12 text-center name">Jakob Larsson</p></div><div class="col-xs-3 img-wrapper"><img class="col-xs-12" src="images/jaokim.png"><p class="col-xs-12 text-center name">Joakim Ljunggren</p></div><div class="col-xs-3 img-wrapper"><img class="col-xs-12" src="images/sandra.png"><p class="col-xs-12 text-center name">Sandra Liljeqvist</p></div><div class="col-xs-3 img-wrapper"><img class="col-xs-12" src="images/unn.png"><p class="col-xs-12 text-center name">Unn Swanström</p></div></div><div class="navbar"><ul class="nav col-xs-offset-4 col-xs-4"><li class="col-xs-4"><a ng-click="openAbout()">About</a></li><li class="col-xs-4"><img src="images/logo2.png" class="pull-right"></li><li class="col-xs-4"><a href="#/admin">Admin</a></li></ul></div></div>',restrict:"E",link:function(a,b){a.aboutOpen=!1,b.find("#about-section").css("max-height","0px"),a.openAbout=function(){console.log("openAbout"),a.aboutOpen===!0?b.find("#about-section").css("max-height","0px"):b.find("#about-section").css("max-height","500px"),a.aboutOpen=!a.aboutOpen}}}});